
default_platform(:android)

platform :android do

  desc "Deploy a new version to play store"
  lane :production do
    update_fastlane
    sh "bundle exec fastlane update_plugins"
    sh "flutter build appbundle --flavor airqo"
    upload_to_play_store(
      track: "production",
      release_status: "draft",
      json_key_data: ENV['MOBILE_ANDROID_PLAYSTORE_SA'],
      package_name:"com.airqo.app",
      aab: "../build/app/outputs/bundle/airqoRelease/app-airqo-release.aab",
    )
  end

  desc "Deploy to new version to Firebase App Distribution"
  lane :distribute do
    update_fastlane
    sh "bundle exec fastlane update_plugins"
    sh "flutter build appbundle --flavor airqo" 
    firebase_app_distribution(
      app: ENV['MOBILE_ANDROID_ID_FIREBASE'],
      android_artifact_path:"../build/app/outputs/bundle/airqoRelease/app-airqo-release.aab",
      release_notes_file: "fastlane/release_notes.txt",
      service_credentials_file: "fastlane/firebase-app-distribution.json",
      android_artifact_type: "AAB",
      groups: "airqo-team",
      )
  end
end